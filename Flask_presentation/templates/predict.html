<html>
    <head>
        <title>Final Project</title>
        <script src="https://d3js.org/d3.v7.min.js"></script>
        <script src = "https://d3js.org/d3-request.v1.min.js"></script>
        <link rel="stylesheet" href="static/css/styles.css">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
        <script>
            function onRequestStateCounties()
            {
                var requested_state = d3.select('#requested_state').node().value
                const url = "http://127.0.0.1:5000/listStateCounties?state="+requested_state
                fetch(url).then(function(response) {
                    return response.json();
                }).then(function(data) {
                    var tbody = d3.select("#county_options");
                    tbody.html("")
                    data.counties.forEach((county) => {
                        let row = tbody.append("option");
                        row.value = county;
                        row.text(county);
                    });
                }).catch(function() {
                    console.log("Booo");
                });
            }
        
            function onMakePrediction()
            {
                var requested_state = d3.select('#requested_state').node().value;
                const url = "http://127.0.0.1:5000/makePrediction"
                var payload = {
                    race_white: d3.select('#race_white').node().value,
                    race_black: d3.select('#race_black').node().value,
                    race_asian: d3.select('#race_asian').node().value,
                    race_others: d3.select('#race_others').node().value,
                    race_two_or_more: d3.select('#race_two_or_more').node().value
                };

                fetch(url, {
                method: 'POST',
                headers: {
                    'Accept': 'application/json, text/plain, */*',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(payload)
                }).then(res => res.json())
                .then((res) => {
                    console.log(res)
                    d3.select("#prediction_value_val").html(res.prediction)
                });
            }
        
            function onGetCountyDemographic()
            {
                var requested_county = d3.select('#county_options').node().value;
                const url = "http://127.0.0.1:5000/getCountyDemogrographic?county="+requested_county;
                fetch(url, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json, text/plain, */*',
                        'Content-Type': 'application/json'
                    }
                }).then(function(response) {
                    return response.json();
                }).then(function(data) {
                   console.log(data.demographic)
                   var demographic = (JSON.parse(data.demographic))
                   console.log('demographic', demographic)
                   console.log(demographic['race_white'])
                   d3.select("#race_white").property("value", demographic['race_white']);
                   d3.select("#race_black").property("value", demographic['race_black']);
                   d3.select("#race_asian").property("value", demographic['race_asian']);
                   d3.select("#race_others").property("value", demographic['race_other']);
                   d3.select("#race_two_or_more").property("value", demographic['race_two_or_more']);
                    d3.select("#baseline_unemployment_pct").html(demographic['unemployed_pct'])
                   baseline_unemployment_pct
                }).catch(function() {
                    console.log("Booo");
                });
            }
        
        </script>
    </head>
    <body>
            <div class="container form">
                {% if prediction_value_val %}
                <div class="row">
                    <div class="col-md-12">
                        <div>Conditional True</div>
                    </div>
                </div>

                {% else %}
                    <div>NOPE</div>
                {% endif %}
        
                <div class="row">
                    <div class="col-md-12">
                        <ul class="top-nav">
                            <li><a href="/">Home</a></li>
                            <li><a href="/analysis">Analysis</a></li>
                            <li><a href="/predict" class="active">Predict</a></li>
                        </ul>
                    </div>
                </div>

                <div class="row">
                    
                        <div class="col-md-8">
                            
                                <div class="row">
                                    
                                    <!-- State options -->
                                    <div class="col-md-6">
                                        <!--<form action = "/predict" method = "POST">-->
                                        <input type="hidden" name="request_type" value="listCounties">
                                        <select name="requested_state" id="requested_state" class="form-control">
                                            {% for state in states_options %}
                                            <option value="{{state}}" {% if state==selected_state_val %} selected="selected" {% endif %}>{{state}}</option>
                                            {% endfor %}
                                        </select>
                                        {% if requested_county is not defined %}
                                        <input type="submit" class="form-control btn btn-primary" value="Get Counties" onclick="onRequestStateCounties()">
                                        {% endif %}
                                    <!--</form>-->
                                    </div>
                                    

                                    <!-- County options -->
                                    <div class="col-md-6">
                                        <form action = "/predict" method = "POST">
                                        <input type="hidden" name="request_type" value="listCountyData">
                                        <select name="requested_county" id="county_options" class="form-control">
                                            <!--
                                            {% for county in state_counties_options %}
                                            <option value="{{county}}" {% if county==selected_county_val %} selected="selected" {% endif %}>{{county}}</option>
                                            {% endfor %}
                                            -->
                                        </select>
                                        {% if requested_county is not defined %}
                                        <input type="button" class="form-control btn btn-primary" value="Get Baseline data analysis" onclick="onGetCountyDemographic()">
                                        {% endif %}
                                        </form>
                                    </div>
                                    
                                </div>

                               
                                <div class="row">
                                    <div class="col-md-12">
                                        <form action = "/predict" method = "POST">
                                            <input type="hidden" name="request_type" value="makePrediction">
                                            <div class="row">
                                                <div class="col-md-3"><label for="race_white">Race White</label></div>
                                                <div class="col-md-9"><input type="number" id="race_white" name="race_white" value="0" class="form-control"></div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-3"><label for="race_black">Race Black</label></div>
                                                <div class="col-md-9"><input type="number" id="race_black" name="race_black" class="form-control"></div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-3"><label for="race_asian">Race Asian</label></div>
                                                <div class="col-md-9"><input type="number"id="race_asian" name="race_asian" class="form-control"></div>
                                            </div>

                                            <div class="row">
                                                <div class="col-md-3"><label for="race_asian">Race Others</label></div>
                                                <div class="col-md-9"><input type="number"id="race_others" name="race_others" class="form-control"></div>
                                            </div>

                                            <div class="row">
                                                <div class="col-md-3"><label for="race_asian">Race Two or More</label></div>
                                                <div class="col-md-9"><input type="number"id="race_two_or_more" name="race_two_or_more" class="form-control"></div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-3"></div>
                                                <div class="col-md-9"><input type="button" onclick="onMakePrediction()" class="btn btn-success form-control" value="Predict"></div>    
                                            </div>
                                        </form>
                                    </div>
                                </div>
                        </div>
                    

                    <div class="col-md-4">
                        Baseline/comparison
                        <h4 id="baseline_unemployment_pct"></h4>
                        <hr>
                        <h4 id="prediction_value_val"></h4>
                        <p><b>{{selected_county_val}}</b></p>
                        <p><b>{{selected_state_val}}</b></p>
                        
                    </div>
                </div>

                <!--
                <div class="row">
                    <div class="col-md-12">
                        <h2>{{prediction_value_val}}</h2>
                        value1_val {{value1_val}}<br>
                        value1_entered1_val {{value1_entered_val}}<br>
                        value1_entered2_val {{value2_entered_val}}<br>
                        value1_entered3_val {{value3_entered_val}}<br>
                    </div>
                </div>
                -->
            </div>
       
    </body>
</html>


    